<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - GestiÃ³n de Activos</title>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="title">ðŸ’¡ Â¿QUÃ‰ DESEA REALIZAR?</h1>

        <div class="options" id="options-container">
            <a href="#" data-href="/ver-activos" class="option" id="ver-activos">
                <img src="assets/icon-activos.png" alt="Ver activos disponibles">
                <p>Ver activos disponibles</p>
            </a>
            <a href="#" data-href="/registrar-activo" class="option" id="registrar-activo">
                <img src="assets/icon-registrar-activo.png" alt="Registrar Activo">
                <p>Registrar Activo</p>
            </a>
            <a href="#" data-href="/registrar-incidencia" class="option" id="registrar-incidencia">
                <img src="assets/icon-registrar-incidencia.png" alt="Registrar Incidencia">
                <p>Registrar Incidencia</p>
            </a>
            <a href="#" data-href="/registrar-empleado" class="option admin-only" id="registrar-empleado">
                <img src="assets/icon-persona.png" alt="Registrar empleados">
                <p>Registrar empleados</p>
            </a>
            <a href="#" data-href="/registrar-usuario" class="option admin-only" id="registrar-usuario">
                <img src="assets/icon-gear.png" alt="Registrar usuarios">
                <p>Registrar usuarios</p>
            </a>
        </div>
        <br>
        <button id="logout-button" class="btn-gray">Cerrar SesiÃ³n</button>
    </div>

    <script src="/auth.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const userData = await checkAuth();
            if (!userData) {
                console.log('No autenticado, redirigiendo a login');
                window.location.href = '/login.html';
                return;
            }
    
            const isAdmin = userData.user.isAdmin;
            if (!isAdmin) {
                document.querySelectorAll(".admin-only").forEach(option => option.style.display = "none");
            }
    
            document.querySelectorAll(".option").forEach(link => {
                link.addEventListener("click", async (e) => {
                    e.preventDefault();
                    const href = link.getAttribute("data-href");
                    const authData = await checkAuth();
                    if (authData) {
                        const token = localStorage.getItem('token');
                        console.log("Token para cookie:", token);
                        if (!token) {
                            console.error("No se encontrÃ³ token en localStorage");
                            window.location.href = '/login.html';
                            return;
                        }
    
                        // Restablecer la cookie solo si no existe
                        if (!document.cookie.includes('authToken')) {
                            document.cookie = `authToken=${token}; path=/; SameSite=Strict;`;
                            console.log("Cookie establecida:", document.cookie);
                        }
                        window.location.href = href;
                    }
                });
            });
    
            document.getElementById("logout-button").addEventListener("click", () => logout());
        });
    </script>
</body>
</html>